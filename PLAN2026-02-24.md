# PLAN: BRAIN + Aline Integration + Intent Dissolution
**Date:** 2026-02-24
**Project:** D:\XOGO\BAINALINE
**Source:** BRAIN-ALINE-STRATEGY.md + session design decisions

---

## Objective

Integrate Aline persistent memory into the BRAIN workflow at phase gates, implement a per-intent dissolution mechanism to keep the repo lean for both finite and ongoing projects, and add broad keyword-triggered Aline checkpointing for all non-BRAIN sessions.

---

## Deliverables

| # | Deliverable | File | Status |
|---|---|---|---|
| 1 | Aline phase-gate calls embedded in BRAIN flow | `.claude/commands/brain.md` | Done ✓ |
| 2 | Stop hook safety net | `.claude/settings.json` | Removed — Aline CLI has no `commit` command. MCP-only. |
| 3 | Per-intent dissolution prompt + lifecycle update | `.claude/commands/brain.md` | Done ✓ |
| 4 | New `/dissolve` command — two-level: intent + feature folder | `.claude/commands/dissolve.md` | Done ✓ |
| 5 | UserPromptSubmit hook — broad keyword trigger | `.claude/settings.json` | Done ✓ |
| 6 | Aline Checkpoint behavior rule | `CLAUDE.md` | Done ✓ |
| 7 | `/recap` updated — Aline recall first + Memory read | `.claude/commands/recap.md` | Done ✓ |

---

## Design Decisions (from session)

### Intent Dissolution Strategy: Option C — Two-level per-intent dissolution

**Level 1 — Intent dissolution** (triggers after each intent marked Done):
- Extracts Goal + Outcome + Key Decisions + Follow-ups → appends to `Memory/ProjectName.md` → Aline commit → deletes intent file → Status row = `Dissolved ✓`

**Level 2 — Feature folder dissolution** (cascades automatically when last intent dissolves):
- Claude checks if ALL intents in the folder are `Dissolved ✓`
- If yes → prompts user to dissolve the feature folder too
- Extracts CONTEXT.md scope + Status.md table → appends Feature Summary to `Memory/ProjectName.md` → Aline commit → deletes CONTEXT.md, Status.md, folder

**Rules:**
- Both levels are **manual** — always prompt, never auto-delete
- Works for both **finite** and **ongoing** projects
- `Intents/` stays permanently lean — only folders with active work exist
- Memory stored in **both** `Memory/ProjectName.md` (human-readable) and Aline commits (AI-readable)

### Stop Hook: Not viable

- Aline has no `commit` CLI command — commits are MCP-only (triggered from within a Claude session)
- Replaced by UserPromptSubmit hook (Deliverable 5) + CLAUDE.md behavior rule (Deliverable 6)

### Non-BRAIN Aline Checkpointing

- `UserPromptSubmit` hook fires on broad keywords: `commit|push|save|done|ship|merge|finish|complete|deploy|deployed|finished`
- Hook injects a reminder into Claude's context to generate a smart summary and offer an Aline update
- `CLAUDE.md` Aline Checkpoint rule defines natural pause points and the ask-before-commit protocol
- Claude always shows the summary and asks before writing to Aline — never silent

---

## What the Repo Looks Like at Any Time

```
Intents/
  ProjectName/
    CONTEXT.md          ← scope definition (never deleted)
    Status.md           ← full history, rows: Active / Done / Dissolved ✓
    03-ActiveThing.md   ← only currently active/pending intents

Memory/
  ProjectName.md        ← rolling distilled log of all dissolved intents
```

---

## Dissolution Flow

```
Intent marked Done in Status.md
  ↓
Claude prompts: "Intent N is Done. Want to dissolve it?
  This will: extract key learnings → append to Memory/ProjectName.md
  → Aline commit → delete intent file → mark row as Dissolved ✓"
  ↓
User: yes →
  1. Read intent file
  2. Extract: Goal, Outcome, Key Decisions, Follow-ups
  3. Append structured entry to Memory/ProjectName.md (create if missing)
  4. Aline commit: "dissolved: intent N {ShortName} — {outcome}"
  5. Delete intent .md file
  6. Update Status.md row → Dissolved ✓

User: no → file stays, no action
```

---

## Aline Phase Gates (brain.md)

| Phase Gate | Aline Action |
|---|---|
| `/brain` invoked (Step 0) | Recall: `use aline — prior context on {IdeaTitle}` |
| Refine interview complete (Step 4b) | Commit: `BRAIN Refine locked — {IdeaFolder} scope set` |
| Arrange approved (Step 7b) | Commit: `BRAIN Arrange approved — intents 01–N for {IdeaFolder}` |
| Each intent Done (Iterate phase) | Commit: `Intent {N} done: {ShortName} — {outcome summary}` |
| Next phase | Commit: `session end — {IdeaFolder} status: {Active|Paused|Complete}` |

---

## Aline Checkpoint — Natural Pause Points (CLAUDE.md rule)

| Pause Point | What Claude does |
|---|---|
| Git commit just completed | Generates smart 1-line summary → asks "Want me to update Aline?" |
| Task / bug / feature confirmed done | Same |
| User signals session end | Same |
| Significant decision made | Same |
| Mid-task (not a pause point) | Does nothing — no Aline prompt |
| Inside BRAIN session at phase gate | Aline already called — no double-commit |

---

## Files Modified / Created

| File | Change |
|---|---|
| `.claude/commands/brain.md` | 5 Aline phase-gate calls + dissolution prompt added |
| `.claude/commands/dissolve.md` | New — full per-intent dissolution command |
| `.claude/settings.json` | UserPromptSubmit hook with broad keyword matcher |
| `CLAUDE.md` | Aline Checkpoint behavior rule added |
| `.claude/commands/recap.md` | Step 0 (Aline recall) + Step 4 (Memory read) + output format updated |

## Files NOT Modified

| File | Reason |
|---|---|
| `BRAIN-ALINE-STRATEGY.md` | Strategy reference only |
| Any existing intent files | Runtime artifacts |

---

## Verification Checklist

- [ ] `/brain "TestIdea"` → Claude calls `use aline` recall at start
- [ ] Complete Refine → Aline commit offered
- [ ] Approve Arrange → Aline commit offered
- [ ] Complete one intent → dissolution prompt appears
- [ ] Accept dissolution → `Memory/TestIdea.md` created, intent file deleted, Status row = `Dissolved ✓`
- [ ] Run `/dissolve "TestIdea" 1` → Level 1 intent dissolution executes correctly
- [ ] Dissolve last intent in a folder → Level 2 feature folder prompt appears
- [ ] Accept Level 2 → Feature Summary appended to Memory, folder deleted from Intents/
- [ ] Decline Level 2 → folder stays as lightweight archive, no action
- [ ] Type "commit this" in any session → UserPromptSubmit hook fires, Claude offers Aline update after commit
- [ ] Type "done for today" → Claude detects pause point, offers Aline update
- [ ] Run `/recap` → Aline recall fires first, Memory file read if present, full output includes "Aline Context" and "Past Work (dissolved)" fields
